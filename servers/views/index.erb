<html>
<head>
  <script type="text/javascript" src="<%= @config["faye_remote_url_js"] %>"></script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
  
  <script type="text/javascript">
    var client = new Faye.Client('<%= @config["faye_remote_url"] %>faye');
    var subscription = client.subscribe('/foo/<%= @token %>', function(message) {
      $(document).ready(function (){
        $("#speed").html(message.speed).closest("div").fadeIn();
        $("#tryagain").show();
        $("#status").hide();
      });
    });

    $(document).ready(function(){
      $("#download").click(function(){
        $(this).fadeOut(function(){
          $("#status").fadeIn();
        });
      });
    });
  </script>
</head>
<body>
  
  <center>
  <div style="width:800px; margin:auto 0;">

    <div>
      <h2>Проверка скорости Интернета</h2>
    </div>

  <a id="download" href="<%= @config["file_download_url"] %><%= @token %>" target="_blank">Начать проверку!</a>
  <div id="status" style="display:none;">Идет скачивание файла. Не прерывайте загрузку</div>
  <br>

  <div style="display:none;background-color:#8FE866;padding:5px;width:300px;">
    Ваша скорость: <span id="speed"></span>
  </div>
  <div style="display:none;margin-top:30px;" id="tryagain">
    <a href="<%= @config["frontend_url"] %>">Попробовать еще раз</a>
  </div>

  </div>
  </center>

</body>
</html>
